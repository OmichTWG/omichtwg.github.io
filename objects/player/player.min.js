addObject({name:"player",spriteStay:sprites.get("player"),spriteJump:sprites.get("playerJump"),spriteWalk:sprites.get("playerWalk"),spriteRun:sprites.get("playerRun"),spriteCrawl:sprites.get("playerCrawl"),playerCrawlStay:sprites.get("playerCrawlStay"),playerClimb:sprites.get("playerClimb"),tpX:16,tpY:20,collider:{type:"box",x1:-3,y1:-16,x2:3,y2:12},parent:"physics",speed:2,jump:3,delayedJump:!1,stepCounter:0,stopper:!1,wasChainDialog:!1,crt:!1,create(){global.player=this,this.sprite=this.spriteStay,global.wasStarted||"start-room"!==currentRoom.name||setTimeout((()=>startDialog(startScene))),instanceCreate("chain",this.x,this.y),instanceCreate("strongman",this.x+("final-room"===currentRoom.name?0:global.chainLength-10),this.y-2)},step(){if(!this.crt){const t=findNearest("camera");t.target=this,t.x=this.x-camera.w()/2,t.y=this.y-camera.h()/2,this.crt=!0}if(getPause())return void(this.animationSpeed=0);const t=collisionCollider("solid",this.x,this.y+2,this.collider),s=distanceBetween(global.strongman.x,global.strongman.y,this.x,this.y),e=Math.abs(this.ax)>.1;if(this.calculateParams(t,s,e),this.chainMove(t,s),this.move(t),this.stepSound(e),"final-room"!==currentRoom.name){if(this.properties?.unactive){if(!t)return;this.properties.unactive=!1}this.controls()}else collisionCollider("endCollider",this.x,this.y,this.collider)?global.wasEnded||(startDialog(global.cannibalism?finalNeutralDialog:finalDialog),this.sprite=this.spriteStay,this.frameNumber=0,global.wasEnded=!0):this.ax=getCurrentSpeed()},controls(){let t=!1;keyPress.has("KeyD")&&(this.ax=!this.speed&&this.x<global.strongman.x?1:this.speed,this.scaleX=1,t=!0),keyPress.has("KeyA")&&(this.ax=!this.speed&&this.x>global.strongman.x?-1:-this.speed,this.scaleX=-1,t=!0),!this.speed&&t&&(this.sprite=this.spriteWalk),keyDown.has("Space")&&collisionCollider("solid",this.x,this.y+16,this.collider)&&(this.delayedJump=!0),this.isColliding&&this.delayedJump&&(this.ay=-this.jump,this.delayedJump=!1)},move(t){let s=!0;keyPress.has("KeyW")&&global.strongman.isColliding&&this.y>=global.strongman.y+4&&Math.abs(global.strongman.x-this.x)<16&&!global.strongman.taken&&!global.strongman.throwed&&(this.ax=0,this.ay=-this.speed,s=!1);const e=-getDirectionVector(this.x,this.y-16,global.strongman.x,global.strongman.y).y;this.physics({collide:s,gravity:s,moveMultiplier:1-(!t&&!global.strongman.throwed&&!global.strongman.taken&&e>0?e:0)}),this.y>currentRoom.h&&goToLastCp()},chainMove(t,s){if(s>global.chainLength){const e=getDirectionVector(global.strongman.x,global.strongman.y,this.x,this.y);this.x=global.strongman.x+e.x*global.chainLength,(!t||global.strongman.throwed||s>2*global.chainLength)&&(this.y=global.strongman.y+e.y*global.chainLength),this.animationSpeed=.1,global.wasStarted||"start-room"!==currentRoom.name||this.wasChainDialog||(setTimeout((()=>{startDialog(chainScene),instanceCreate("rat",global.strongman.x+96,global.strongman.y-180)}),2e3),this.wasChainDialog=!0)}},calculateParams(t,s,e){global.strongman.taken?(global.strongman.x=global.player.x+10,global.strongman.y=global.player.y-28,this.speed=.5,this.jump=1.5):(this.speed=2,this.jump=3),s>global.chainLength-10?e?(this.sprite=this.spriteWalk,this.animationSpeed=.1):(this.sprite=this.spriteStay,this.frameNumber=0):e?(this.sprite=global.strongman.taken?this.spriteCrawl:this.spriteRun,this.animationSpeed=global.strongman.taken?.1:.2):(this.sprite=global.strongman.taken?this.playerCrawlStay:this.spriteStay,this.frameNumber=0),t||(this.sprite=global.strongman.taken?this.playerCrawlStay:this.spriteJump,this.frameNumber=0),s>global.chainLength-1&&(this.speed=getCurrentSpeed())},stepSound(t){if(t&&!this.ay)if(this.stepCounter>0)this.stepCounter--;else{const t=this.speed;this.stepCounter=15/t,playSoundWV("step"+random(1,4),.5)}}});